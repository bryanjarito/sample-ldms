import{u as E,d as X,a as Y}from"./index-aa414725.js";import{u as Z}from"./useProjects-5bf93676.js";import{d as T,r as i,o as m,a as U,w as u,h as C,i as I,n as ee,b as o,e as p,t as k,F as q,c as N,J as F,u as c,D as A,K as S,_ as L,k as D,p as te}from"./index-7a1b065c.js";import{_ as O,u as M}from"./useUsers-7679b103.js";import{u as oe}from"./useModal-b32e5a1a.js";import{u as ae}from"./useToast-e379f7bf.js";import"./projects-88949a9d.js";import"./utils-b2fc192b.js";import"./users-d55249cb.js";const z=T({__name:"ProjectStatusBadge",props:{status:{type:String,required:!0}},setup(y){const b={"in progress":"primary",archived:"secondary",completed:"success",important:"warning"};return(d,v)=>{const n=i("VaBadge");return m(),U(n,{square:"",color:b[d.$props.status],text:d.$props.status.toUpperCase()},null,8,["color","text"])}}}),se={class:"text-[var(--va-secondary)]"},le={class:"flex flex-col items-center gap-4 grow"},ne={class:"va-h4 text-center self-stretch overflow-hidden line-clamp-2 text-ellipsis"},re=p("span",{class:"text-[var(--va-secondary)]"},"Owner: ",-1),ie={class:"flex justify-between"},ce={key:1,class:"p-4 flex justify-center items-center text-[var(--va-secondary)]"},de=T({__name:"ProjectCards",props:{projects:{type:Array,required:!0},loading:{type:Boolean,required:!0}},emits:["edit","delete"],setup(y){const b=d=>{const v=["primary","#FFD43A","#ADFF00","#262824","danger"],n=d.charCodeAt(0)%v.length;return v[n]};return(d,v)=>{const n=i("VaAvatarGroup"),$=i("VaDivider"),V=i("VaButton"),j=i("VaCardContent"),f=i("VaCard"),r=i("VaInnerLoading");return y.projects.length>0||y.loading?(m(),U(r,{key:0,loading:y.loading,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 min-h-[4rem]"},{default:u(()=>[(m(!0),C(q,null,I(y.projects,e=>(m(),U(f,{key:e.project_name,style:ee({"--va-card-outlined-border":"1px solid var(--va-background-element)"}),outlined:""},{default:u(()=>[o(j,{class:"flex flex-col h-full"},{default:u(()=>[p("div",se,k(e.creation_date),1),p("div",le,[p("h4",ne,k(e.project_name),1),p("p",null,[re,p("span",null,k(e.project_owner.fullname),1)]),o(n,{class:"my-4",options:e.team.map(s=>({label:s.fullname,src:s.avatar,fallbackText:s.fullname[0],color:b(s.fullname)})),max:5},null,8,["options"]),o(z,{status:e.status},null,8,["status"])]),o($,{class:"my-6"}),p("div",ie,[o(V,{preset:"secondary",icon:"mso-edit",color:"secondary",onClick:s=>d.$emit("edit",e)},null,8,["onClick"]),o(V,{preset:"secondary",icon:"mso-delete",color:"danger",onClick:s=>d.$emit("delete",e)},null,8,["onClick"])])]),_:2},1024)]),_:2},1032,["style"]))),128))]),_:1},8,["loading"])):(m(),C("div",ce,"No projects"))}}}),ue={class:"ellipsis max-w-[230px] lg:max-w-[450px]"},pe={class:"flex items-center gap-2 ellipsis max-w-[230px]"},me={class:"flex gap-2 justify-end"},ge={class:"flex flex-col-reverse md:flex-row gap-2 justify-between items-center py-2"},ve={key:0,class:"flex"},_e=T({__name:"ProjectsTable",props:{projects:{type:Array,required:!0},loading:{type:Boolean,required:!0},sortBy:{type:Object,required:!0},sortingOrder:{type:Object,required:!0},pagination:{type:Object,required:!0}},emits:["edit","delete"],setup(y,{emit:b}){const d=X([{label:"Project name",key:"project_name",sortable:!0},{label:"Project owner",key:"project_owner",sortable:!0},{label:"Team",key:"team",sortable:!0},{label:"Status",key:"status",sortable:!0},{label:"Creation Date",key:"creation_date",sortable:!0},{label:" ",key:"actions"}]),v=y,n=b,$=r=>{const e=["primary","#FFD43A","#ADFF00","#262824","danger"],s=r.charCodeAt(0)%e.length;return e[s]},V=E(v,"sortBy",n),j=E(v,"sortingOrder",n),f=N(()=>Math.ceil(v.pagination.total/v.pagination.perPage));return(r,e)=>{const s=i("VaAvatarGroup"),l=i("VaButton"),P=i("VaDataTable"),h=i("VaSelect"),B=i("VaPagination");return m(),C("div",null,[o(P,{"sort-by":c(V),"onUpdate:sortBy":e[0]||(e[0]=a=>A(V)?V.value=a:null),"sorting-order":c(j),"onUpdate:sortingOrder":e[1]||(e[1]=a=>A(j)?j.value=a:null),items:y.projects,columns:c(d),loading:y.loading},{"cell(project_name)":u(({rowData:a})=>[p("div",ue,k(a.project_name),1)]),"cell(project_owner)":u(({rowData:a})=>[p("div",pe,[o(O,{user:a.project_owner,size:"small"},null,8,["user"]),F(" "+k(a.project_owner.fullname),1)])]),"cell(team)":u(({rowData:a})=>[o(s,{size:"small",options:a.team.map(x=>({label:x.fullname,src:x.avatar,fallbackText:x.fullname[0],color:$(x.fullname)})),max:5},null,8,["options"])]),"cell(status)":u(({rowData:a})=>[o(z,{status:a.status},null,8,["status"])]),"cell(actions)":u(({rowData:a})=>[p("div",me,[o(l,{preset:"primary",size:"small",color:"primary",icon:"mso-edit","aria-label":"Edit project",onClick:x=>r.$emit("edit",a)},null,8,["onClick"]),o(l,{preset:"primary",size:"small",icon:"mso-delete",color:"danger","aria-label":"Delete project",onClick:x=>r.$emit("delete",a)},null,8,["onClick"])])]),_:1},8,["sort-by","sorting-order","items","columns","loading"]),p("div",ge,[p("div",null,[p("b",null,k(r.$props.pagination.total)+" results.",1),F(" Results per page "),o(h,{modelValue:r.$props.pagination.perPage,"onUpdate:modelValue":e[2]||(e[2]=a=>r.$props.pagination.perPage=a),class:"!w-20",options:[10,50,100]},null,8,["modelValue"])]),f.value>1?(m(),C("div",ve,[o(l,{preset:"secondary",icon:"va-arrow-left","aria-label":"Previous page",disabled:r.$props.pagination.page===1,onClick:e[3]||(e[3]=a=>r.$props.pagination.page--)},null,8,["disabled"]),o(l,{class:"mr-2",preset:"secondary",icon:"va-arrow-right","aria-label":"Next page",disabled:r.$props.pagination.page===f.value,onClick:e[4]||(e[4]=a=>r.$props.pagination.page++)},null,8,["disabled"]),o(B,{modelValue:r.$props.pagination.page,"onUpdate:modelValue":e[5]||(e[5]=a=>r.$props.pagination.page=a),"buttons-preset":"secondary",pages:f.value,"visible-pages":5,"boundary-links":!1,"direction-links":!1},null,8,["modelValue","pages"])])):S("",!0)])])}}});const fe=L(_e,[["__scopeId","data-v-6b0380a6"]]),ye={class:"flex justify-end flex-col-reverse sm:flex-row mt-4 gap-2"},be=T({__name:"EditProjectForm",props:{project:{},saveButtonLabel:{}},emits:["save","close"],setup(y,{expose:b}){const d=y,v={project_name:"",project_owner:void 0,team:[],status:void 0},n=D({...v}),$=N(()=>Object.keys(n.value).some(s=>{var l;return s==="team"?!1:n.value[s]!==((l=d.project??v)==null?void 0:l[s])}));b({isFormHasUnsavedChanges:$}),te(()=>d.project,()=>{d.project&&(n.value={...d.project,project_owner:d.project.project_owner})},{immediate:!0});const V=s=>!!s||"This field is required",{users:j,filters:f}=M({pagination:D({page:1,perPage:100,total:10})}),{users:r,filters:e}=M({pagination:D({page:1,perPage:100,total:10})});return(s,l)=>{const P=i("VaInput"),h=i("VaSelect"),B=i("VaButton"),a=i("VaForm");return m(),U(a,{class:"flex flex-col gap-2"},{default:u(({validate:x})=>[o(P,{modelValue:n.value.project_name,"onUpdate:modelValue":l[0]||(l[0]=t=>n.value.project_name=t),label:"Project name",rules:[V]},null,8,["modelValue","rules"]),o(h,{modelValue:n.value.project_owner,"onUpdate:modelValue":l[1]||(l[1]=t=>n.value.project_owner=t),search:c(e).search,"onUpdate:search":l[2]||(l[2]=t=>c(e).search=t),searchable:"",label:"Owner","text-by":"fullname","track-by":"id",rules:[V],options:c(r)},{content:u(({value:t})=>[t?(m(),C("div",{key:t.id,class:"flex items-center gap-1 mr-4"},[o(O,{user:t,size:"18px"},null,8,["user"]),F(" "+k(t.fullname),1)])):S("",!0)]),_:1},8,["modelValue","search","rules","options"]),o(h,{modelValue:n.value.team,"onUpdate:modelValue":l[3]||(l[3]=t=>n.value.team=t),search:c(f).search,"onUpdate:search":l[4]||(l[4]=t=>c(f).search=t),label:"Team","text-by":"fullname","track-by":"id",multiple:"",rules:[t=>"length"in t&&t.length>0||"This field is required"],options:c(j),"max-visible-options":s.$vaBreakpoint.mdUp?3:1},{content:u(({valueArray:t})=>[t?(m(!0),C(q,{key:0},I(t,(g,_)=>(m(),C("div",{key:g.id,class:"flex items-center gap-1 mr-2"},[o(O,{user:g,size:"18px"},null,8,["user"]),F(" "+k(g.fullname)+k(_<t.length-1?",":""),1)]))),128)):S("",!0)]),_:1},8,["modelValue","search","rules","options","max-visible-options"]),o(h,{modelValue:n.value.status,"onUpdate:modelValue":l[5]||(l[5]=t=>n.value.status=t),label:"Status",rules:[V],"track-by":"value","value-by":"value",options:[{text:"In progress",value:"in progress"},{text:"Archived",value:"archived"},{text:"Completed",value:"completed"},{text:"Important",value:"important"}]},{content:u(({value:t})=>[t?(m(),U(z,{key:0,status:t.value},null,8,["status"])):S("",!0)]),_:1},8,["modelValue","rules"]),p("div",ye,[o(B,{preset:"secondary",color:"secondary",onClick:l[6]||(l[6]=t=>s.$emit("close"))},{default:u(()=>[F("Cancel")]),_:1}),o(B,{onClick:t=>x()&&s.$emit("save",n.value)},{default:u(()=>[F(k(s.saveButtonLabel),1)]),_:2},1032,["onClick"])])]),_:1})}}});const Ve=L(be,[["__scopeId","data-v-cc1c112b"]]),je=p("h1",{class:"page-title"},"Projects",-1),xe={class:"flex flex-col md:flex-row gap-2 mb-2 justify-between"},we={class:"flex flex-col md:flex-row gap-2 justify-start"},ke={key:0,class:"va-h5 mb-4"},Ce={key:1,class:"va-h5 mb-4"},Ae=T({__name:"ProjectsPage",setup(y){const b=Y("projects-view",!0),{projects:d,update:v,add:n,isLoading:$,remove:V,pagination:j,sorting:f}=Z(),r=D(null),e=D(!1),s=g=>{r.value=g,e.value=!0},l=()=>{r.value=null,e.value=!0},{init:P}=ae(),h=async g=>{e.value=!1,"id"in g?(await v(g),P({message:"Project updated",color:"success"})):(await n(g),P({message:"Project created",color:"success"}))},{confirm:B}=oe(),a=async g=>{await B({title:"Delete project",message:`Are you sure you want to delete project "${g.project_name}"?`,okText:"Delete",size:"small",maxWidth:"380px"})&&(await V(g),P({message:"Project deleted",color:"success"}))},x=D(),t=async g=>{x.value.isFormHasUnsavedChanges?await B({maxWidth:"380px",message:"Form has unsaved changes. Are you sure you want to close it?",size:"small"})&&g():g()};return(g,_)=>{const G=i("VaButtonToggle"),R=i("VaButton"),H=i("VaCardContent"),W=i("VaModal"),J=i("VaCard");return m(),C(q,null,[je,o(J,null,{default:u(()=>[o(H,null,{default:u(()=>[p("div",xe,[p("div",we,[o(G,{modelValue:c(b),"onUpdate:modelValue":_[0]||(_[0]=w=>A(b)?b.value=w:null),color:"background-element","border-color":"background-element",options:[{label:"Cards",value:!0},{label:"Table",value:!1}]},null,8,["modelValue"])]),o(R,{icon:"add",onClick:l},{default:u(()=>[F("Project")]),_:1})]),c(b)?(m(),U(de,{key:0,projects:c(d),loading:c($),onEdit:s,onDelete:a},null,8,["projects","loading"])):(m(),U(fe,{key:1,"sort-by":c(f).sortBy,"onUpdate:sortBy":_[1]||(_[1]=w=>c(f).sortBy=w),"sorting-order":c(f).sortingOrder,"onUpdate:sortingOrder":_[2]||(_[2]=w=>c(f).sortingOrder=w),pagination:c(j),"onUpdate:pagination":_[3]||(_[3]=w=>A(j)?j.value=w:null),projects:c(d),loading:c($),onEdit:s,onDelete:a},null,8,["sort-by","sorting-order","pagination","projects","loading"]))]),_:1}),o(W,{modelValue:e.value,"onUpdate:modelValue":_[4]||(_[4]=w=>e.value=w),size:"small","mobile-fullscreen":"","close-button":"",stateful:"","hide-default-actions":"","before-cancel":t},{default:u(({cancel:w,ok:K})=>[r.value===null?(m(),C("h1",ke,"Add project")):(m(),C("h1",Ce,"Edit project")),o(Ve,{ref_key:"editFormRef",ref:x,project:r.value,"save-button-label":r.value===null?"Add":"Save",onClose:w,onSave:Q=>{h(Q),K()}},null,8,["project","save-button-label","onClose","onSave"])]),_:1},8,["modelValue"])]),_:1})],64)}}});export{Ae as default};
//# sourceMappingURL=ProjectsPage-2c9a32cc.js.map
