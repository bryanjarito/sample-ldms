import{u as E,d as K,a as Q}from"./index-aa414725.js";import{w as X,a as Y,u as Z,r as ee,g as te}from"./projects-88949a9d.js";import{k as C,u as c,d as D,r as m,o as _,a as B,w as v,h as $,i as I,n as ae,b as a,e as f,t as k,F as q,c as L,J as F,D as S,K as T,_ as R,p as oe}from"./index-7a1b065c.js";import{_ as O,u as M}from"./useUsers-7679b103.js";import{u as se}from"./useModal-b32e5a1a.js";import{u as ne}from"./useToast-e379f7bf.js";import"./utils-b2fc192b.js";import"./users-d55249cb.js";const le=()=>C({page:1,perPage:10,total:0}),re=()=>C({sortBy:"creation_date",sortingOrder:"desc"}),ie=j=>{const i=C(!1),u=C([]),{sorting:g=re(),pagination:o=le()}=j??{},b=async()=>{i.value=!0;const{data:l,pagination:p}=await te({...c(g),...c(o)});u.value=l,V(()=>{o.value=p}),i.value=!1},{ignoreUpdates:V}=X([o,g],b,{deep:!0});return b(),{isLoading:i,projects:u,fetch:b,async add(l){i.value=!0,await Y({...l,project_owner:l.project_owner.id,team:l.team.map(p=>p.id)}),await b(),i.value=!1},async update(l){i.value=!0,await Z({...l,project_owner:l.project_owner.id,team:l.team.map(p=>p.id)}),await b(),i.value=!1},async remove(l){i.value=!0,await ee({...l,project_owner:l.project_owner.id,team:l.team.map(p=>p.id)}),await b(),i.value=!1},pagination:o,sorting:g}},z=D({__name:"ProjectStatusBadge",props:{status:{type:String,required:!0}},setup(j){const i={"in progress":"primary",archived:"secondary",completed:"success",important:"warning"};return(u,g)=>{const o=m("VaBadge");return _(),B(o,{square:"",color:i[u.$props.status],text:u.$props.status.toUpperCase()},null,8,["color","text"])}}}),de={class:"text-[var(--va-secondary)]"},ce={class:"flex flex-col items-center gap-4 grow"},ue={class:"va-h4 text-center self-stretch overflow-hidden line-clamp-2 text-ellipsis"},pe=f("span",{class:"text-[var(--va-secondary)]"},"Owner: ",-1),me={class:"flex justify-between"},ge={key:1,class:"p-4 flex justify-center items-center text-[var(--va-secondary)]"},ve=D({__name:"ProjectCards",props:{projects:{type:Array,required:!0},loading:{type:Boolean,required:!0}},emits:["edit","delete"],setup(j){const i=u=>{const g=["primary","#FFD43A","#ADFF00","#262824","danger"],o=u.charCodeAt(0)%g.length;return g[o]};return(u,g)=>{const o=m("VaAvatarGroup"),b=m("VaDivider"),V=m("VaButton"),l=m("VaCardContent"),p=m("VaCard"),d=m("VaInnerLoading");return j.projects.length>0||j.loading?(_(),B(d,{key:0,loading:j.loading,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 min-h-[4rem]"},{default:v(()=>[(_(!0),$(q,null,I(j.projects,t=>(_(),B(p,{key:t.project_name,style:ae({"--va-card-outlined-border":"1px solid var(--va-background-element)"}),outlined:""},{default:v(()=>[a(l,{class:"flex flex-col h-full"},{default:v(()=>[f("div",de,k(t.creation_date),1),f("div",ce,[f("h4",ue,k(t.project_name),1),f("p",null,[pe,f("span",null,k(t.project_owner.fullname),1)]),a(o,{class:"my-4",options:t.team.map(r=>({label:r.fullname,src:r.avatar,fallbackText:r.fullname[0],color:i(r.fullname)})),max:5},null,8,["options"]),a(z,{status:t.status},null,8,["status"])]),a(b,{class:"my-6"}),f("div",me,[a(V,{preset:"secondary",icon:"mso-edit",color:"secondary",onClick:r=>u.$emit("edit",t)},null,8,["onClick"]),a(V,{preset:"secondary",icon:"mso-delete",color:"danger",onClick:r=>u.$emit("delete",t)},null,8,["onClick"])])]),_:2},1024)]),_:2},1032,["style"]))),128))]),_:1},8,["loading"])):(_(),$("div",ge,"No projects"))}}}),fe={class:"ellipsis max-w-[230px] lg:max-w-[450px]"},_e={class:"flex items-center gap-2 ellipsis max-w-[230px]"},ye={class:"flex gap-2 justify-end"},be={class:"flex flex-col-reverse md:flex-row gap-2 justify-between items-center py-2"},je={key:0,class:"flex"},Ve=D({__name:"ProjectsTable",props:{projects:{type:Array,required:!0},loading:{type:Boolean,required:!0},sortBy:{type:Object,required:!0},sortingOrder:{type:Object,required:!0},pagination:{type:Object,required:!0}},emits:["edit","delete"],setup(j,{emit:i}){const u=K([{label:"Project name",key:"project_name",sortable:!0},{label:"Project owner",key:"project_owner",sortable:!0},{label:"Team",key:"team",sortable:!0},{label:"Status",key:"status",sortable:!0},{label:"Creation Date",key:"creation_date",sortable:!0},{label:" ",key:"actions"}]),g=j,o=i,b=d=>{const t=["primary","#FFD43A","#ADFF00","#262824","danger"],r=d.charCodeAt(0)%t.length;return t[r]},V=E(g,"sortBy",o),l=E(g,"sortingOrder",o),p=L(()=>Math.ceil(g.pagination.total/g.pagination.perPage));return(d,t)=>{const r=m("VaAvatarGroup"),s=m("VaButton"),U=m("VaDataTable"),P=m("VaSelect"),h=m("VaPagination");return _(),$("div",null,[a(U,{"sort-by":c(V),"onUpdate:sortBy":t[0]||(t[0]=n=>S(V)?V.value=n:null),"sorting-order":c(l),"onUpdate:sortingOrder":t[1]||(t[1]=n=>S(l)?l.value=n:null),items:j.projects,columns:c(u),loading:j.loading},{"cell(project_name)":v(({rowData:n})=>[f("div",fe,k(n.project_name),1)]),"cell(project_owner)":v(({rowData:n})=>[f("div",_e,[a(O,{user:n.project_owner,size:"small"},null,8,["user"]),F(" "+k(n.project_owner.fullname),1)])]),"cell(team)":v(({rowData:n})=>[a(r,{size:"small",options:n.team.map(x=>({label:x.fullname,src:x.avatar,fallbackText:x.fullname[0],color:b(x.fullname)})),max:5},null,8,["options"])]),"cell(status)":v(({rowData:n})=>[a(z,{status:n.status},null,8,["status"])]),"cell(actions)":v(({rowData:n})=>[f("div",ye,[a(s,{preset:"primary",size:"small",color:"primary",icon:"mso-edit","aria-label":"Edit project",onClick:x=>d.$emit("edit",n)},null,8,["onClick"]),a(s,{preset:"primary",size:"small",icon:"mso-delete",color:"danger","aria-label":"Delete project",onClick:x=>d.$emit("delete",n)},null,8,["onClick"])])]),_:1},8,["sort-by","sorting-order","items","columns","loading"]),f("div",be,[f("div",null,[f("b",null,k(d.$props.pagination.total)+" results.",1),F(" Results per page "),a(P,{modelValue:d.$props.pagination.perPage,"onUpdate:modelValue":t[2]||(t[2]=n=>d.$props.pagination.perPage=n),class:"!w-20",options:[10,50,100]},null,8,["modelValue"])]),p.value>1?(_(),$("div",je,[a(s,{preset:"secondary",icon:"va-arrow-left","aria-label":"Previous page",disabled:d.$props.pagination.page===1,onClick:t[3]||(t[3]=n=>d.$props.pagination.page--)},null,8,["disabled"]),a(s,{class:"mr-2",preset:"secondary",icon:"va-arrow-right","aria-label":"Next page",disabled:d.$props.pagination.page===p.value,onClick:t[4]||(t[4]=n=>d.$props.pagination.page++)},null,8,["disabled"]),a(h,{modelValue:d.$props.pagination.page,"onUpdate:modelValue":t[5]||(t[5]=n=>d.$props.pagination.page=n),"buttons-preset":"secondary",pages:p.value,"visible-pages":5,"boundary-links":!1,"direction-links":!1},null,8,["modelValue","pages"])])):T("",!0)])])}}});const we=R(Ve,[["__scopeId","data-v-b4bd7618"]]),xe={class:"flex justify-end flex-col-reverse sm:flex-row mt-4 gap-2"},ke=D({__name:"EditProjectForm",props:{project:{},saveButtonLabel:{}},emits:["save","close"],setup(j,{expose:i}){const u=j,g={project_name:"",project_owner:void 0,team:[],status:void 0},o=C({...g}),b=L(()=>Object.keys(o.value).some(r=>{var s;return r==="team"?!1:o.value[r]!==((s=u.project??g)==null?void 0:s[r])}));i({isFormHasUnsavedChanges:b}),oe(()=>u.project,()=>{u.project&&(o.value={...u.project,project_owner:u.project.project_owner})},{immediate:!0});const V=r=>!!r||"This field is required",{users:l,filters:p}=M({pagination:C({page:1,perPage:100,total:10})}),{users:d,filters:t}=M({pagination:C({page:1,perPage:100,total:10})});return(r,s)=>{const U=m("VaInput"),P=m("VaSelect"),h=m("VaButton"),n=m("VaForm");return _(),B(n,{class:"flex flex-col gap-2"},{default:v(({validate:x})=>[a(U,{modelValue:o.value.project_name,"onUpdate:modelValue":s[0]||(s[0]=e=>o.value.project_name=e),label:"Project name",rules:[V]},null,8,["modelValue","rules"]),a(P,{modelValue:o.value.project_owner,"onUpdate:modelValue":s[1]||(s[1]=e=>o.value.project_owner=e),search:c(t).search,"onUpdate:search":s[2]||(s[2]=e=>c(t).search=e),searchable:"",label:"Owner","text-by":"fullname","track-by":"id",rules:[V],options:c(d)},{content:v(({value:e})=>[e?(_(),$("div",{key:e.id,class:"flex items-center gap-1 mr-4"},[a(O,{user:e,size:"18px"},null,8,["user"]),F(" "+k(e.fullname),1)])):T("",!0)]),_:1},8,["modelValue","search","rules","options"]),a(P,{modelValue:o.value.team,"onUpdate:modelValue":s[3]||(s[3]=e=>o.value.team=e),search:c(p).search,"onUpdate:search":s[4]||(s[4]=e=>c(p).search=e),label:"Team","text-by":"fullname","track-by":"id",multiple:"",rules:[e=>"length"in e&&e.length>0||"This field is required"],options:c(l),"max-visible-options":r.$vaBreakpoint.mdUp?3:1},{content:v(({valueArray:e})=>[e?(_(!0),$(q,{key:0},I(e,(y,A)=>(_(),$("div",{key:y.id,class:"flex items-center gap-1 mr-2"},[a(O,{user:y,size:"18px"},null,8,["user"]),F(" "+k(y.fullname)+k(A<e.length-1?",":""),1)]))),128)):T("",!0)]),_:1},8,["modelValue","search","rules","options","max-visible-options"]),a(P,{modelValue:o.value.status,"onUpdate:modelValue":s[5]||(s[5]=e=>o.value.status=e),label:"Status",rules:[V],"track-by":"value","value-by":"value",options:[{text:"In progress",value:"in progress"},{text:"Archived",value:"archived"},{text:"Completed",value:"completed"},{text:"Important",value:"important"}]},{content:v(({value:e})=>[e?(_(),B(z,{key:0,status:e.value},null,8,["status"])):T("",!0)]),_:1},8,["modelValue","rules"]),f("div",xe,[a(h,{preset:"secondary",color:"secondary",onClick:s[6]||(s[6]=e=>r.$emit("close"))},{default:v(()=>[F("Cancel")]),_:1}),a(h,{onClick:e=>x()&&r.$emit("save",o.value)},{default:v(()=>[F(k(r.saveButtonLabel),1)]),_:2},1032,["onClick"])])]),_:1})}}});const Ce=R(ke,[["__scopeId","data-v-776bcbc1"]]),$e=f("h1",{class:"page-title"},"Rivers",-1),Pe={class:"flex flex-col md:flex-row gap-2 mb-2 justify-between"},he={class:"flex flex-col md:flex-row gap-2 justify-start"},Be={key:0,class:"va-h5 mb-4"},Fe={key:1,class:"va-h5 mb-4"},Ee=D({__name:"RiversPage",setup(j){const i=Q("projects-view",!0),{projects:u,update:g,add:o,isLoading:b,remove:V,pagination:l,sorting:p}=ie(),d=C(null),t=C(!1),r=e=>{d.value=e,t.value=!0},{init:s}=ne(),U=async e=>{t.value=!1,"id"in e?(await g(e),s({message:"Project updated",color:"success"})):(await o(e),s({message:"Project created",color:"success"}))},{confirm:P}=se(),h=async e=>{await P({title:"Delete project",message:`Are you sure you want to delete project "${e.project_name}"?`,okText:"Delete",size:"small",maxWidth:"380px"})&&(await V(e),s({message:"Project deleted",color:"success"}))},n=C(),x=async e=>{n.value.isFormHasUnsavedChanges?await P({maxWidth:"380px",message:"Form has unsaved changes. Are you sure you want to close it?",size:"small"})&&e():e()};return(e,y)=>{const A=m("VaButtonToggle"),N=m("VaCardContent"),G=m("VaModal"),H=m("VaCard");return _(),$(q,null,[$e,a(H,null,{default:v(()=>[a(N,null,{default:v(()=>[f("div",Pe,[f("div",he,[a(A,{modelValue:c(i),"onUpdate:modelValue":y[0]||(y[0]=w=>S(i)?i.value=w:null),color:"background-element","border-color":"background-element",options:[{label:"Cards",value:!0},{label:"Table",value:!1}]},null,8,["modelValue"])])]),c(i)?(_(),B(ve,{key:0,projects:c(u),loading:c(b),onEdit:r,onDelete:h},null,8,["projects","loading"])):(_(),B(we,{key:1,"sort-by":c(p).sortBy,"onUpdate:sortBy":y[1]||(y[1]=w=>c(p).sortBy=w),"sorting-order":c(p).sortingOrder,"onUpdate:sortingOrder":y[2]||(y[2]=w=>c(p).sortingOrder=w),pagination:c(l),"onUpdate:pagination":y[3]||(y[3]=w=>S(l)?l.value=w:null),projects:c(u),loading:c(b),onEdit:r,onDelete:h},null,8,["sort-by","sorting-order","pagination","projects","loading"]))]),_:1}),a(G,{modelValue:t.value,"onUpdate:modelValue":y[4]||(y[4]=w=>t.value=w),size:"small","mobile-fullscreen":"","close-button":"",stateful:"","hide-default-actions":"","before-cancel":x},{default:v(({cancel:w,ok:W})=>[d.value===null?(_(),$("h1",Be,"Add project")):(_(),$("h1",Fe,"Edit project")),a(Ce,{ref_key:"editFormRef",ref:n,project:d.value,"save-button-label":d.value===null?"Add":"Save",onClose:w,onSave:J=>{U(J),W()}},null,8,["project","save-button-label","onClose","onSave"])]),_:1},8,["modelValue"])]),_:1})],64)}}});export{Ee as default};
//# sourceMappingURL=RiversPage-a78455ea.js.map
