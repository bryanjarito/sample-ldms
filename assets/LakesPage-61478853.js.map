{"version":3,"file":"LakesPage-61478853.js","sources":["../../src/pages/lakes/widgets/LakesTable.vue","../../src/pages/lakes/LakesPage.vue"],"sourcesContent":["<script setup lang=\"ts\">\nimport { defineVaDataTableColumns, useModal } from 'vuestic-ui'\nimport { Lake } from '../types'\nimport { PropType, computed, toRef } from 'vue'\nimport { Pagination, Sorting } from '../../../data/pages/lakes'\nimport { useVModel } from '@vueuse/core'\nimport { Project } from '../../projects/types'\n\nconst columns = defineVaDataTableColumns([\n  { label: 'English Name', key: 'englishName', sortable: true },\n  { label: 'gujaratiName', key: 'gujaratiName', sortable: true },\n  { label: 'geoTag', key: 'geoTag', sortable: true },\n  { label: 'village', key: 'village', sortable: true },\n  { label: 'droneShots', key: 'droneShots', sortable: true },\n  { label: ' ', key: 'actions', align: 'right' },\n])\n\nconst props = defineProps({\n  lakes: {\n    type: Array as PropType<Lake[]>,\n    required: true,\n  },\n  loading: { type: Boolean, default: false },\n  pagination: { type: Object as PropType<Pagination>, required: true },\n  sortBy: { type: String as PropType<Sorting['sortBy']>, required: true },\n  sortingOrder: { type: String as PropType<Sorting['sortingOrder']>, required: true },\n})\n\nconst emit = defineEmits<{\n  (event: 'edit-user', user: User): void\n  (event: 'delete-user', user: User): void\n  (event: 'update:sortBy', sortBy: Sorting['sortBy']): void\n  (event: 'update:sortingOrder', sortingOrder: Sorting['sortingOrder']): void\n}>()\n\nconst lakes = toRef(props, 'lakes')\nconst sortByVModel = useVModel(props, 'sortBy', emit)\nconst sortingOrderVModel = useVModel(props, 'sortingOrder', emit)\n\nconst roleColors: Record<UserRole, string> = {\n  admin: 'danger',\n  user: 'background-element',\n  owner: 'warning',\n}\n\nconst totalPages = computed(() => Math.ceil(props.pagination.total / props.pagination.perPage))\n\nconst { confirm } = useModal()\n\nconst onUserDelete = async (lake: Lake) => {\n  const agreed = await confirm({\n    title: 'Delete user',\n    message: `Are you sure you want to delete ${lake.englishName}?`,\n    okText: 'Delete',\n    cancelText: 'Cancel',\n    size: 'small',\n    maxWidth: '380px',\n  })\n\n  if (agreed) {\n    emit('delete-user', lake)\n  }\n}\n\nconst formatProjectNames = (projects: Project[]) => {\n  if (projects.length === 0) return 'No projects'\n  if (projects.length <= 2) {\n    return projects.map((project) => project.project_name).join(', ')\n  }\n\n  return (\n    projects\n      .slice(0, 2)\n      .map((project) => project.project_name)\n      .join(', ') +\n    ' + ' +\n    (projects.length - 2) +\n    ' more'\n  )\n}\n</script>\n\n<template>\n  <VaDataTable\n    v-model:sort-by=\"sortByVModel\"\n    v-model:sorting-order=\"sortingOrderVModel\"\n    :columns=\"columns\"\n    :items=\"lakes\"\n    :loading=\"$props.loading\"\n  >\n    <template #cell(englishName)=\"{ rowData }\">\n      <div class=\"flex items-center gap-2 max-w-[230px] ellipsis\">\n        <!-- <UserAvatar :lake=\"rowData as Lake\" size=\"small\" /> -->\n        {{ rowData.englishName }}\n      </div>\n    </template>\n\n    <template #cell(gujaratiName)=\"{ rowData }\">\n      <div class=\"max-w-[120px] ellipsis\">\n        {{ rowData.gujaratiName }}\n      </div>\n    </template>\n\n    <template #cell(geoTag)=\"{ rowData }\">\n      <div class=\"ellipsis max-w-[120px]\">\n        <a href=\"#\" class=\"va-link\">{{ rowData.geoTag }}</a>\n      </div>\n    </template>\n\n    <template #cell(droneShots)=\"{ rowData }\">\n      <div class=\"ellipsis max-w-[120px]\">\n        <a href=\"#\" class=\"va-link\">{{ rowData.droneShots }}</a>\n      </div>\n    </template>\n\n    <template #cell(village)=\"{ rowData }\">\n      {{ rowData.village }}\n    </template>\n\n    <template #cell(actions)=\"{ rowData }\">\n      <div class=\"flex gap-2 justify-end\">\n        <RouterLink :to=\"`${rowData.id}`\" aria-label=\"Visit home page\">\n          <VaButton\n            preset=\"primary\"\n            size=\"small\"\n            icon=\"visibility\"\n            aria-label=\"View lake\"\n          />\n        </RouterLink>\n        <VaButton\n          preset=\"primary\"\n          size=\"small\"\n          icon=\"mso-edit\"\n          aria-label=\"Edit lake\"\n          @click=\"$emit('edit-user', rowData as Lake)\"\n        />\n        <VaButton\n          preset=\"primary\"\n          size=\"small\"\n          icon=\"mso-delete\"\n          color=\"danger\"\n          aria-label=\"Delete lake\"\n          @click=\"onUserDelete(rowData as Lake)\"\n        />\n      </div>\n    </template>\n  </VaDataTable>\n\n  <div class=\"flex flex-col-reverse md:flex-row gap-2 justify-between items-center py-2\">\n    <div>\n      <b>{{ $props.pagination.total }} results.</b>\n      Results per page\n      <VaSelect v-model=\"$props.pagination.perPage\" class=\"!w-20\" :options=\"[10, 50, 100]\" />\n    </div>\n\n    <div v-if=\"totalPages > 1\" class=\"flex\">\n      <VaButton\n        preset=\"secondary\"\n        icon=\"va-arrow-left\"\n        aria-label=\"Previous page\"\n        :disabled=\"$props.pagination.page === 1\"\n        @click=\"$props.pagination.page--\"\n      />\n      <VaButton\n        class=\"mr-2\"\n        preset=\"secondary\"\n        icon=\"va-arrow-right\"\n        aria-label=\"Next page\"\n        :disabled=\"$props.pagination.page === totalPages\"\n        @click=\"$props.pagination.page++\"\n      />\n      <VaPagination\n        v-model=\"$props.pagination.page\"\n        buttons-preset=\"secondary\"\n        :pages=\"totalPages\"\n        :visible-pages=\"5\"\n        :boundary-links=\"false\"\n        :direction-links=\"false\"\n      />\n    </div>\n  </div>\n</template>\n\n<style lang=\"scss\" scoped>\n.va-data-table {\n  ::v-deep(.va-data-table__table-tr) {\n    border-bottom: 1px solid var(--va-background-border);\n  }\n}\n</style>\n","<script setup lang=\"ts\">\nimport { ref } from 'vue'\nimport LakesTable from './widgets/LakesTable.vue'\nimport EditUserForm from './widgets/EditLakeForm.vue'\nimport { Lake } from './types'\nimport { useLakes } from './composables/useLakes'\nimport { useModal, useToast } from 'vuestic-ui'\n\nconst doShowEditUserModal = ref(false)\n\nconst { lakes, isLoading, filters, sorting, pagination, ...usersApi } = useLakes()\n\nconst userToEdit = ref<Lake | null>(null)\n\nconst showEditUserModal = (lake: Lake) => {\n  userToEdit.value = lake\n  doShowEditUserModal.value = true\n}\n\nconst showAddUserModal = () => {\n  userToEdit.value = null\n  doShowEditUserModal.value = true\n}\n\nconst { init: notify } = useToast()\n\nconst onUserSaved = async (lake: Lake) => {\n  if (userToEdit.value) {\n    await usersApi.update(lake)\n    notify({\n      message: `${lake.englishName} has been updated`,\n      color: 'success',\n    })\n  } else {\n    usersApi.add(lake)\n    notify({\n      message: `${lake.englishName} has been created`,\n      color: 'success',\n    })\n  }\n}\n\nconst onUserDelete = async (lake: Lake) => {\n  await usersApi.remove(lake)\n  notify({\n    message: `${lake.englishName} has been deleted`,\n    color: 'success',\n  })\n}\n\nconst editFormRef = ref()\n\nconst { confirm } = useModal()\n\nconst beforeEditFormModalClose = async (hide: () => unknown) => {\n  if (editFormRef.value.isFormHasUnsavedChanges) {\n    const agreed = await confirm({\n      maxWidth: '380px',\n      message: 'Form has unsaved changes. Are you sure you want to close it?',\n      size: 'small',\n    })\n    if (agreed) {\n      hide()\n    }\n  } else {\n    hide()\n  }\n}\n</script>\n\n<template>\n  <h1 class=\"page-title\">Lakes</h1>\n\n  <VaCard>\n    <VaCardContent>\n      <div class=\"flex flex-col md:flex-row gap-2 mb-2 justify-between\">\n        <div class=\"flex flex-col md:flex-row gap-2 justify-start\">\n          <!-- <VaButtonToggle\n            v-model=\"filters.isActive\"\n            color=\"background-element\"\n            border-color=\"background-element\"\n            :options=\"[\n              { label: 'Active', value: true },\n              { label: 'Inactive', value: false },\n            ]\"\n          /> -->\n          <VaInput v-model=\"filters.search\" placeholder=\"Search\">\n            <template #prependInner>\n              <VaIcon name=\"search\" color=\"secondary\" size=\"small\" />\n            </template>\n          </VaInput>\n        </div>\n        <!-- <RouterLink to=\"/lake/lake-list/lake-create\" aria-label=\"Visit home page\">\n          Add User\n        </RouterLink>\n        <VaButton @click=\"showAddUserModal\">Add User</VaButton> -->\n      </div>\n\n      <LakesTable\n        v-model:sort-by=\"sorting.sortBy\"\n        v-model:sorting-order=\"sorting.sortingOrder\"\n        :lakes=\"lakes\"\n        :loading=\"isLoading\"\n        :pagination=\"pagination\"\n        @editUser=\"showEditUserModal\"\n        @deleteUser=\"onUserDelete\"\n      />\n    </VaCardContent>\n  </VaCard>\n\n  <VaModal\n    v-slot=\"{ cancel, ok }\"\n    v-model=\"doShowEditUserModal\"\n    size=\"small\"\n    mobile-fullscreen\n    close-button\n    hide-default-actions\n    :before-cancel=\"beforeEditFormModalClose\"\n  >\n    <h1 class=\"va-h5\">{{ userToEdit ? 'Edit user' : 'Add user' }}</h1>\n    <EditUserForm\n      ref=\"editFormRef\"\n      :user=\"userToEdit\"\n      :save-button-label=\"userToEdit ? 'Save' : 'Add'\"\n      @close=\"cancel\"\n      @save=\"\n        (user) => {\n          onUserSaved(user)\n          ok()\n        }\n      \"\n    />\n  </VaModal>\n</template>\n"],"names":["columns","defineVaDataTableColumns","props","__props","emit","__emit","lakes","toRef","sortByVModel","useVModel","sortingOrderVModel","totalPages","computed","confirm","useModal","onUserDelete","lake","doShowEditUserModal","ref","isLoading","filters","sorting","pagination","usersApi","useLakes","userToEdit","showEditUserModal","notify","useToast","onUserSaved","editFormRef","beforeEditFormModalClose","hide"],"mappings":"wrCAQA,MAAMA,EAAUC,EAAyB,CACvC,CAAE,MAAO,eAAgB,IAAK,cAAe,SAAU,EAAK,EAC5D,CAAE,MAAO,eAAgB,IAAK,eAAgB,SAAU,EAAK,EAC7D,CAAE,MAAO,SAAU,IAAK,SAAU,SAAU,EAAK,EACjD,CAAE,MAAO,UAAW,IAAK,UAAW,SAAU,EAAK,EACnD,CAAE,MAAO,aAAc,IAAK,aAAc,SAAU,EAAK,EACzD,CAAE,MAAO,IAAK,IAAK,UAAW,MAAO,OAAQ,CAAA,CAC9C,EAEKC,EAAQC,EAWRC,EAAOC,EAOPC,EAAQC,EAAML,EAAO,OAAO,EAC5BM,EAAeC,EAAUP,EAAO,SAAUE,CAAI,EAC9CM,EAAqBD,EAAUP,EAAO,eAAgBE,CAAI,EAQ1DO,EAAaC,EAAS,IAAM,KAAK,KAAKV,EAAM,WAAW,MAAQA,EAAM,WAAW,OAAO,CAAC,EAExF,CAAE,QAAAW,GAAYC,IAEdC,EAAe,MAAOC,GAAe,CAC1B,MAAMH,EAAQ,CAC3B,MAAO,cACP,QAAS,mCAAmCG,EAAK,WAAW,IAC5D,OAAQ,SACR,WAAY,SACZ,KAAM,QACN,SAAU,OAAA,CACX,GAGCZ,EAAK,cAAeY,CAAI,CAC1B,s5ECrDI,MAAAC,EAAsBC,EAAI,EAAK,EAE/B,CAAE,MAAAZ,EAAO,UAAAa,EAAW,QAAAC,EAAS,QAAAC,EAAS,WAAAC,EAAY,GAAGC,GAAaC,IAElEC,EAAaP,EAAiB,IAAI,EAElCQ,EAAqBV,GAAe,CACxCS,EAAW,MAAQT,EACnBC,EAAoB,MAAQ,EAAA,EAQxB,CAAE,KAAMU,CAAO,EAAIC,EAAS,EAE5BC,EAAc,MAAOb,GAAe,CACpCS,EAAW,OACP,MAAAF,EAAS,OAAOP,CAAI,EACnBW,EAAA,CACL,QAAS,GAAGX,EAAK,WAAW,oBAC5B,MAAO,SAAA,CACR,IAEDO,EAAS,IAAIP,CAAI,EACVW,EAAA,CACL,QAAS,GAAGX,EAAK,WAAW,oBAC5B,MAAO,SAAA,CACR,EACH,EAGID,EAAe,MAAOC,GAAe,CACnC,MAAAO,EAAS,OAAOP,CAAI,EACnBW,EAAA,CACL,QAAS,GAAGX,EAAK,WAAW,oBAC5B,MAAO,SAAA,CACR,CAAA,EAGGc,EAAcZ,IAEd,CAAE,QAAAL,GAAYC,IAEdiB,EAA2B,MAAOC,GAAwB,CAC1DF,EAAY,MAAM,wBACL,MAAMjB,EAAQ,CAC3B,SAAU,QACV,QAAS,+DACT,KAAM,OAAA,CACP,GAEMmB,IAGFA,GACP"}