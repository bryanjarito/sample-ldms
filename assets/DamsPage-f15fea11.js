import{u as E,d as J}from"./index-aa414725.js";import{u as q}from"./useModal-b32e5a1a.js";import{d as P,r as c,o as B,a as T,W as K,c as N,h as D,b as s,w as V,e as m,J as O,t as C,u as i,D as M,K as I,F as L,_ as Q,k as w,p as R,Q as G}from"./index-7a1b065c.js";import{u as X}from"./useForm-c9dd0d22.js";import{u as Y}from"./useProjects-5bf93676.js";import{v as h}from"./utils-b2fc192b.js";import{a as Z,u as ee,r as ae,g as le}from"./users-d55249cb.js";import{w as se}from"./projects-88949a9d.js";import{u as te}from"./useToast-e379f7bf.js";const W=P({__name:"UserAvatar",props:{user:{type:Object,required:!0},size:{type:String,default:"medium"}},setup(b){const u=n=>{const p=["primary","#FFD43A","#ADFF00","#262824","danger"],e=n.charCodeAt(0)%p.length;return p[e]},x=n=>n.startsWith("http")||n.startsWith("blob:");return(n,p)=>{const e=c("VaAvatar");return B(),T(e,{size:b.size,src:x(b.user.avatar)?b.user.avatar:"","fallback-text":b.user.avatar||b.user.fullname[0],color:u(b.user.fullname)},null,8,["size","src","fallback-text","color"])}}}),oe={class:"flex items-center gap-2 max-w-[230px] ellipsis"},ne={class:"max-w-[120px] ellipsis"},re={class:"ellipsis max-w-[230px]"},ie={class:"ellipsis max-w-[300px] lg:max-w-[450px]"},ue={class:"flex gap-2 justify-end"},de={class:"flex flex-col-reverse md:flex-row gap-2 justify-between items-center py-2"},me={key:0,class:"flex"},ce=P({__name:"UsersTable",props:{users:{type:Array,required:!0},loading:{type:Boolean,default:!1},pagination:{type:Object,required:!0},sortBy:{type:String,required:!0},sortingOrder:{type:String,required:!0}},emits:["edit-user","delete-user","update:sortBy","update:sortingOrder"],setup(b,{emit:u}){const x=J([{label:"Full Name",key:"fullname",sortable:!0},{label:"Email",key:"email",sortable:!0},{label:"Username",key:"username",sortable:!0},{label:"Role",key:"role",sortable:!0},{label:"Projects",key:"projects",sortable:!0},{label:" ",key:"actions",align:"right"}]),n=b,p=u,e=K(n,"users"),v=E(n,"sortBy",p),g=E(n,"sortingOrder",p),f={admin:"danger",user:"background-element",owner:"warning"},U=N(()=>Math.ceil(n.pagination.total/n.pagination.perPage)),{confirm:$}=q(),F=async o=>{await $({title:"Delete user",message:`Are you sure you want to delete ${o.fullname}?`,okText:"Delete",cancelText:"Cancel",size:"small",maxWidth:"380px"})&&p("delete-user",o)},S=o=>o.length===0?"No projects":o.length<=2?o.map(a=>a.project_name).join(", "):o.slice(0,2).map(a=>a.project_name).join(", ")+" + "+(o.length-2)+" more";return(o,a)=>{const t=c("VaBadge"),r=c("VaButton"),y=c("VaDataTable"),k=c("VaSelect"),j=c("VaPagination");return B(),D(L,null,[s(y,{"sort-by":i(v),"onUpdate:sortBy":a[0]||(a[0]=l=>M(v)?v.value=l:null),"sorting-order":i(g),"onUpdate:sortingOrder":a[1]||(a[1]=l=>M(g)?g.value=l:null),columns:i(x),items:e.value,loading:o.$props.loading},{"cell(fullname)":V(({rowData:l})=>[m("div",oe,[s(W,{user:l,size:"small"},null,8,["user"]),O(" "+C(l.fullname),1)])]),"cell(username)":V(({rowData:l})=>[m("div",ne,C(l.username),1)]),"cell(email)":V(({rowData:l})=>[m("div",re,C(l.email),1)]),"cell(role)":V(({rowData:l})=>[s(t,{text:l.role,color:f[l.role]},null,8,["text","color"])]),"cell(projects)":V(({rowData:l})=>[m("div",ie,C(S(l.projects)),1)]),"cell(actions)":V(({rowData:l})=>[m("div",ue,[s(r,{preset:"primary",size:"small",icon:"mso-edit","aria-label":"Edit user",onClick:A=>o.$emit("edit-user",l)},null,8,["onClick"]),s(r,{preset:"primary",size:"small",icon:"mso-delete",color:"danger","aria-label":"Delete user",onClick:A=>F(l)},null,8,["onClick"])])]),_:1},8,["sort-by","sorting-order","columns","items","loading"]),m("div",de,[m("div",null,[m("b",null,C(o.$props.pagination.total)+" results.",1),O(" Results per page "),s(k,{modelValue:o.$props.pagination.perPage,"onUpdate:modelValue":a[2]||(a[2]=l=>o.$props.pagination.perPage=l),class:"!w-20",options:[10,50,100]},null,8,["modelValue"])]),U.value>1?(B(),D("div",me,[s(r,{preset:"secondary",icon:"va-arrow-left","aria-label":"Previous page",disabled:o.$props.pagination.page===1,onClick:a[3]||(a[3]=l=>o.$props.pagination.page--)},null,8,["disabled"]),s(r,{class:"mr-2",preset:"secondary",icon:"va-arrow-right","aria-label":"Next page",disabled:o.$props.pagination.page===U.value,onClick:a[4]||(a[4]=l=>o.$props.pagination.page++)},null,8,["disabled"]),s(j,{modelValue:o.$props.pagination.page,"onUpdate:modelValue":a[5]||(a[5]=l=>o.$props.pagination.page=l),"buttons-preset":"secondary",pages:U.value,"visible-pages":5,"boundary-links":!1,"direction-links":!1},null,8,["modelValue","pages"])])):I("",!0)])],64)}}});const pe=Q(ce,[["__scopeId","data-v-9f80c51f"]]),fe={class:"self-stretch flex-col justify-start items-start gap-4 flex"},ve={class:"flex gap-4 flex-col sm:flex-row w-full"},ge={class:"flex gap-4 flex-col sm:flex-row w-full"},Ve={class:"flex gap-4 w-full"},be={class:"w-1/2"},ye={class:"flex items-center w-1/2 mt-4"},_e={class:"flex gap-2 flex-col-reverse items-stretch justify-end w-full sm:flex-row sm:items-center"},we=P({__name:"EditUserForm",props:{user:{type:Object,default:null},saveButtonLabel:{type:String,default:"Save"}},emits:["close","save"],setup(b,{expose:u,emit:x}){const n=b,p={id:-1,avatar:"",fullname:"",role:"user",username:"",notes:"",email:"",active:!0,projects:[]},e=w({...p}),v=N(()=>Object.keys(e.value).some(a=>{var t;return a==="avatar"||a==="projects"?!1:e.value[a]!==((t=n.user??p)==null?void 0:t[a])}));u({isFormHasUnsavedChanges:v}),R(()=>n.user,()=>{n.user&&(e.value={...n.user,avatar:n.user.avatar||""})},{immediate:!0});const g=w(),f=a=>URL.createObjectURL(a);R(g,a=>{e.value.avatar=a?f(a):""});const U=X("add-user-form"),$=x,F=()=>{U.validate()&&$("save",e.value)},S=[{text:"Admin",value:"admin"},{text:"User",value:"user"},{text:"Owner",value:"owner"}],{projects:o}=Y({pagination:w({page:1,perPage:9999,total:10})});return(a,t)=>{const r=c("VaButton"),y=c("VaFileUpload"),k=c("VaInput"),j=c("VaSelect"),l=c("VaCheckbox"),A=c("VaTextarea"),z=c("VaForm");return B(),T(z,{ref:"add-user-form",class:"flex-col justify-start items-start gap-4 inline-flex w-full"},{default:V(({isValid:_})=>[s(y,{modelValue:g.value,"onUpdate:modelValue":t[1]||(t[1]=d=>g.value=d),type:"single","hide-file-list":"",class:"self-stretch justify-start items-center gap-4 inline-flex"},{default:V(()=>[s(W,{user:e.value,size:"large"},null,8,["user"]),s(r,{preset:"primary",size:"small"},{default:V(()=>[O("Add image")]),_:1}),g.value?(B(),T(r,{key:0,preset:"primary",color:"danger",size:"small",icon:"delete",class:"z-10",onClick:t[0]||(t[0]=G(d=>g.value=void 0,["stop"]))})):I("",!0)]),_:1},8,["modelValue"]),m("div",fe,[m("div",ve,[s(k,{modelValue:e.value.fullname,"onUpdate:modelValue":t[2]||(t[2]=d=>e.value.fullname=d),label:"Full name",class:"w-full sm:w-1/2",rules:[i(h).required],name:"fullname"},null,8,["modelValue","rules"]),s(k,{modelValue:e.value.username,"onUpdate:modelValue":t[3]||(t[3]=d=>e.value.username=d),label:"Username",class:"w-full sm:w-1/2",rules:[i(h).required],name:"username"},null,8,["modelValue","rules"])]),m("div",ge,[s(k,{modelValue:e.value.email,"onUpdate:modelValue":t[4]||(t[4]=d=>e.value.email=d),label:"Email",class:"w-full sm:w-1/2",rules:[i(h).required,i(h).email],name:"email"},null,8,["modelValue","rules"]),s(j,{modelValue:e.value.projects,"onUpdate:modelValue":t[5]||(t[5]=d=>e.value.projects=d),label:"Projects",class:"w-full sm:w-1/2",options:i(o),rules:[i(h).required],name:"projects","text-by":"project_name","track-by":"id",multiple:"","max-visible-options":2},null,8,["modelValue","options","rules"])]),m("div",Ve,[m("div",be,[s(j,{modelValue:e.value.role,"onUpdate:modelValue":t[6]||(t[6]=d=>e.value.role=d),label:"Role",class:"w-full",options:S,rules:[i(h).required],name:"role","value-by":"value"},null,8,["modelValue","rules"])]),m("div",ye,[s(l,{modelValue:e.value.active,"onUpdate:modelValue":t[7]||(t[7]=d=>e.value.active=d),label:"Active",class:"w-full",name:"active"},null,8,["modelValue"])])]),s(A,{modelValue:e.value.notes,"onUpdate:modelValue":t[8]||(t[8]=d=>e.value.notes=d),label:"Notes",class:"w-full",name:"notes"},null,8,["modelValue"]),m("div",_e,[s(r,{preset:"secondary",color:"secondary",onClick:t[9]||(t[9]=d=>a.$emit("close"))},{default:V(()=>[O("Cancel")]),_:1}),s(r,{disabled:!_,onClick:F},{default:V(()=>[O(C(b.saveButtonLabel),1)]),_:2},1032,["disabled"])])])]),_:1},512)}}}),xe=()=>w({page:1,perPage:10,total:0}),Ue=()=>w({sortBy:"fullname",sortingOrder:null}),$e=()=>w({isActive:!0,search:""}),ke=b=>{const u=w(!1),x=w([]),{filters:n=$e(),sorting:p=Ue(),pagination:e=xe()}=b||{},v=async()=>{u.value=!0;const{data:f,pagination:U}=await le({...i(n),...i(p),...i(e)});x.value=f,g(()=>{e.value=U}),u.value=!1},{ignoreUpdates:g}=se([e,p],v,{deep:!0});return R(n,()=>{e.value.page=1,v()},{deep:!0}),v(),{isLoading:u,filters:n,sorting:p,pagination:e,users:x,fetch:v,async add(f){u.value=!0,await Z(f),await v(),u.value=!1},async update(f){u.value=!0,await ee(f),await v(),u.value=!1},async remove(f){u.value=!0,await ae(f),await v(),u.value=!1}}},Ce=m("h1",{class:"page-title"},"Dams",-1),je={class:"flex flex-col md:flex-row gap-2 mb-2 justify-between"},he={class:"flex flex-col md:flex-row gap-2 justify-start"},Be={class:"va-h5"},Ee=P({__name:"DamsPage",setup(b){const u=w(!1),{users:x,isLoading:n,filters:p,sorting:e,pagination:v,...g}=ke(),f=w(null),U=r=>{f.value=r,u.value=!0},{init:$}=te(),F=async r=>{f.value?(await g.update(r),$({message:`${r.fullname} has been updated`,color:"success"})):(g.add(r),$({message:`${r.fullname} has been created`,color:"success"}))},S=async r=>{await g.remove(r),$({message:`${r.fullname} has been deleted`,color:"success"})},o=w(),{confirm:a}=q(),t=async r=>{o.value.isFormHasUnsavedChanges?await a({maxWidth:"380px",message:"Form has unsaved changes. Are you sure you want to close it?",size:"small"})&&r():r()};return(r,y)=>{const k=c("VaIcon"),j=c("VaInput"),l=c("VaCardContent"),A=c("VaCard"),z=c("VaModal");return B(),D(L,null,[Ce,s(A,null,{default:V(()=>[s(l,null,{default:V(()=>[m("div",je,[m("div",he,[s(j,{modelValue:i(p).search,"onUpdate:modelValue":y[0]||(y[0]=_=>i(p).search=_),placeholder:"Search"},{prependInner:V(()=>[s(k,{name:"search",color:"secondary",size:"small"})]),_:1},8,["modelValue"])])]),s(pe,{"sort-by":i(e).sortBy,"onUpdate:sortBy":y[1]||(y[1]=_=>i(e).sortBy=_),"sorting-order":i(e).sortingOrder,"onUpdate:sortingOrder":y[2]||(y[2]=_=>i(e).sortingOrder=_),users:i(x),loading:i(n),pagination:i(v),onEditUser:U,onDeleteUser:S},null,8,["sort-by","sorting-order","users","loading","pagination"])]),_:1})]),_:1}),s(z,{modelValue:u.value,"onUpdate:modelValue":y[3]||(y[3]=_=>u.value=_),size:"small","mobile-fullscreen":"","close-button":"","hide-default-actions":"","before-cancel":t},{default:V(({cancel:_,ok:d})=>[m("h1",Be,C(f.value?"Edit user":"Add user"),1),s(we,{ref_key:"editFormRef",ref:o,user:f.value,"save-button-label":f.value?"Save":"Add",onClose:_,onSave:H=>{F(H),d()}},null,8,["user","save-button-label","onClose","onSave"])]),_:1},8,["modelValue"])],64)}}});export{Ee as default};
//# sourceMappingURL=DamsPage-f15fea11.js.map
